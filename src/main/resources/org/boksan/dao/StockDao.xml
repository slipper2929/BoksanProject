<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.boksan.dao.StockDao" >

	<insert id="PalletInsert">
		INSERT INTO b_stock(pallet_num, product_code)
		SELECT LPAD(CONVERT(MAX(pallet_num),SIGNED)+1,3,'0') 
		AS pallet_num, #{product_code} AS product_code
		FROM b_stock
	</insert>
	
	<select id="DeletePalletSelect" resultType="string">
		SELECT pallet_num 
		FROM b_stock
		WHERE product_code = #{data} and stock_num is null
	</select>
	<delete id="pallet_delete">
		DELETE FROM b_stock
		WHERE pallet_num = #{pallet_num}
	</delete>
	
	<select id="moveList" resultType="org.boksan.model.b_stockDTO">
		SELECT s.pallet_num, p.product_code, p.product_name, s.arrive_date, s.house_code 
		FROM b_stock s JOIN b_product p
		ON s.product_code = p.product_code
	</select>
	
	<select id="move_list_search" resultType="org.boksan.model.b_stockDTO">
		SELECT s.pallet_num, p.product_code, p.product_name, s.arrive_date, s.stock_num 
		FROM b_stock s JOIN b_product p
		ON s.product_code = p.product_code
		where s.pallet_num = #{pallet_num}
		or p.product_name = #{product_name}
	</select>
	
	<insert id="move_change" parameterType="Map">
		insert into b_movement_order
		values(#{pallet_num}, #{movement_address})
	</insert>
</mapper>