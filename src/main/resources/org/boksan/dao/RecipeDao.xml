<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.boksan.dao.RecipeDao">
	
	<select id="recipe_add_select" resultType="org.boksan.model.Product_groupDTO">
		select *
		from b_product_group
	</select>
	
	<select id="recipe_add_pselect" resultType="org.boksan.model.Product_selectDTO">
		select product_code, product_name
		from b_product
		where product_group_code = #{data}
	</select>
	
	<insert id="recipe_add_insert">
		INSERT INTO b_recipe
		VALUES(#{recipe_code},#{product_name},#{gross_weight},#{content},#{production_date},#{emp_code});
	</insert>
	
	<insert id="recipe_add_insert_material">
		INSERT INTO material(recipe_code, product_code, material_num)
			VALUES(#{recipe_code},#{product_code},#{material_num})
	</insert>
	
	<select id="recipe_inquiry" resultType="org.boksan.model.Recipe_addDTO">
		<if test = "keyword == null">
		select recipe_code, product_name, gross_weight, production_date
		from(
			select @rownum:=@rownum+1 as rownum, p.*
			from (select @rownum:=0) as tmp, b_recipe p			
			order by recipe_code desc
			) as b_recipe
		<![CDATA[
			where rownum > (#{pagenum} - 1 ) * #{amount} and rownum <= #{pagenum} * 20
		]]>
		</if>
		<if test = "keyword != null">
			select recipe_code, product_name, gross_weight, production_date
			from(
			select @rownum:=@rownum+1 as rownum, p.*
			from (select @rownum:=0) as tmp, b_recipe p		
			where product_name like concat('%',#{keyword},'%')	
			order by recipe_code desc
			) as b_recipe
			<![CDATA[
			where rownum > (#{pagenum} - 1 ) * #{amount} and rownum <= #{pagenum} * 20
		]]>
		</if>
	</select>
	
	<delete id="recipe_delete">
		delete from b_recipe
		where recipe_code = #{recipe_code}
	</delete>
	
	<select id="recipe_inquiry_search" resultType="org.boksan.model.Recipe_addDTO">
		select recipe_code, product_name, gross_weight, production_date
		from b_recipe
		where product_name like concat('%', #{search_text}, '%')
	</select>
	
	<select id="getTotalCount" resultType="int">
		<if test = "keyword == null">
	 		select count(*)
	 		from b_recipe
	 	</if>
	 	<if test = "keyword != null">
		 	select count(*)
	 		from b_recipe
		 	where product_name like concat('%',#{keyword},'%')
	 	</if>
 	</select>
 	
 	<select id="recipe_detail" resultType="org.boksan.model.RecipeDTO">
 		select *
 		from b_recipe
 		where recipe_code = #{rc}
 	</select>
	
</mapper>